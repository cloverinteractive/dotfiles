#!/usr/bin/env bash

# Where we're at right now
START_WD=$(pwd -P)

# What dotfiles branch we want to install
BRANCH_NAME=$1

# All the colors we're using for notifications
SWITCH="\033["
RED="${SWITCH}0;31m"
GREEN="${SWITCH}0;32m"
YELLOW="${SWITCH}1;33m"
NORMAL="${SWITCH}0m"

set -e
echo ''

FILES=(
  ".ackrc"
  ".bash"
  ".bash_profile"
  ".compton.conf"
  ".config"
  ".ctags"
  ".gemrc"
  ".gitconfig"
  ".gitignore"
  ".gitmodules"
  ".ncmpcpp"
  ".psqlrc"
  ".tmux.conf"
  ".vim"
  ".vimrc"
  ".xinitrc"
  ".Xresources"
)

# Print red
error () {
  printf "\r${RED}$1${NORMAL}\n"
  exit
}

# Print green
success () {
  printf "\r${GREEN}$1${NORMAL}\n"
}

# Print yellow
info () {
  printf "\r${YELLOW}$1${NORMAL}\n"
}

fetch_dotfiles () {
  info "Fetching dotfiles..."

  # Figure out the branch we're working on
  if ! [ $BRANCH_NAME ]; then BRANCH_NAME=master; fi

  git clone -b $BRANCH_NAME https://github.com/cloverinteractive/dotfiles.git ~/.dotfiles
  cd ~/.dotfiles

  # Setup submodules to get Vundle working
  git submodule init
  git submodule update

  info "Installing ruby..."
  rbenv install

  if [[ $? == 0 ]]; then
    success "ruby installed"
  fi
}

install () {
  info "Installing dotfiles..."

  cd ~/.dotfiles

  if [[ $? == 0 ]]; then
    # Let's move back to where we ran the installer from
    cd $START_WD

    # Add new bash config into possibly existing .profile or .bashrc
    if [ -f "$HOME/.bashrc" ];  then echo ". ~/.bash_profile" >> ~/.bashrc; fi
    if [ -f "$HOME/.profile" ]; then echo ". ~/.bash_profile" >> ~/.profile; fi

    success "dotfiles generated"
  fi
}


# install

for file in "${FILES[@]}"; do
  echo "NAME ${file}"
done

success "Thanks for installing, please report any issues to https://github.com/cloverinteractive/dotfiles/issues"
info "Run source ~/.bash_profile to load your environment"
